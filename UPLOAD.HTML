<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ - CREATE</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo" onclick="location.href='index.html'">CREATE</div>
        <div class="user-menu">
            <a href="dashboard.html">–ö–∞–±–∏–Ω–µ—Ç</a>
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        </div>
    </header>

    <div class="dashboard">
        <div class="section">
            <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</h2>
            <form class="upload-form" onsubmit="handleUpload(event)">
                <input type="text" id="videoTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ" required>
                <textarea id="videoDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–µ–æ"></textarea>
                
                <div class="upload-area" onclick="document.getElementById('videoFile').click()">
                    <div class="upload-icon">üìÅ</div>
                    <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–∞</p>
                    <span id="fileName">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
                </div>
                
                <input type="file" id="videoFile" accept="video/*" style="display: none" onchange="showFileName()">
                
                <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</button>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let selectedFile = null;

        function showFileName() {
            const fileInput = document.getElementById('videoFile');
            const fileName = document.getElementById('fileName');
            
            if (fileInput.files.length > 0) {
                selectedFile = fileInput.files[0];
                fileName.textContent = selectedFile.name;
            }
        }

        async function handleUpload(e) {
            e.preventDefault();
            
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const title = document.getElementById('videoTitle').value;
            const description = document.getElementById('videoDescription').value;

            if (!selectedFile) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª');
                return;
            }

            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
            const videoUrl = URL.createObjectURL(selectedFile);
            
            // –ü–æ–ª—É—á–∞–µ–º channel_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const channelResponse = await fetch(`/api/user/channel/${user.id}`);
            const channel = await channelResponse.json();
            
            if (!channel) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª!');
                return;
            }

            await uploadVideo(channel.id, title, description, videoUrl, null);
            alert('–í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
            location.href = 'dashboard.html';
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        document.addEventListener('DOMContentLoaded', function() {
            const user = localStorage.getItem('currentUser');
            if (!user) {
                location.href = 'auth.html';
            }
        });
    </script>
</body>
</html>
