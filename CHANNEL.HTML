<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–Ω–∞–ª - CREATE</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo" onclick="location.href='index.html'">CREATE</div>
        <div class="user-menu">
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="dashboard.html" id="dashboardLink">–ö–∞–±–∏–Ω–µ—Ç</a>
        </div>
    </header>

    <div class="channel-page">
        <div class="channel-header">
            <div class="channel-avatar" id="channelAvatar">üë§</div>
            <div class="channel-info">
                <h1 id="channelName"></h1>
                <p id="channelDescription"></p>
                <div class="channel-stats">
                    <span id="subscriberCount">0 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
                    <span id="videoCount">0 –≤–∏–¥–µ–æ</span>
                </div>
                <button onclick="toggleSubscription()" id="subscribeBtn">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
            </div>
        </div>

        <div class="channel-videos">
            <h2>–í–∏–¥–µ–æ –∫–∞–Ω–∞–ª–∞</h2>
            <div class="videos-grid" id="channelVideos">
                <!-- –í–∏–¥–µ–æ –∫–∞–Ω–∞–ª–∞ -->
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let currentChannelId = null;
        let isSubscribed = false;

        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadChannelData();
        });

        function loadChannelData() {
            const urlParams = new URLSearchParams(window.location.search);
            currentChannelId = urlParams.get('id');
            
            if (!currentChannelId) {
                alert('–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
                location.href = 'index.html';
                return;
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–Ω–∞–ª–µ
            fetch(`/api/channels/${currentChannelId}`)
                .then(response => response.json())
                .then(channel => {
                    document.getElementById('channelName').textContent = channel.name;
                    document.getElementById('channelDescription').textContent = channel.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
                    document.getElementById('subscriberCount').textContent = channel.subscribers + ' –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤';
                });

            // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –∫–∞–Ω–∞–ª–∞
            fetch(`/api/channels/${currentChannelId}/videos`)
                .then(response => response.json())
                .then(videos => {
                    document.getElementById('videoCount').textContent = videos.length + ' –≤–∏–¥–µ–æ';
                    displayChannelVideos(videos);
                });

            checkUserSubscription();
        }

        function displayChannelVideos(videos) {
            const container = document.getElementById('channelVideos');
            
            if (videos.length === 0) {
                container.innerHTML = '<p>–ù–∞ –∫–∞–Ω–∞–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –≤–∏–¥–µ–æ</p>';
                return;
            }

            container.innerHTML = videos.map(video => `
                <div class="video-card" onclick="location.href='watch.html?id=${video.id}'">
                    <div class="video-thumbnail">üé¨</div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-stats">
                            <span>üëÅÔ∏è ${video.views}</span>
                            <span>‚ù§Ô∏è ${video.likes}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function checkUserSubscription() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) return;

            const response = await fetch(`/api/check-subscription/${user.id}/${currentChannelId}`);
            isSubscribed = await response.json();
            
            const btn = document.getElementById('subscribeBtn');
            btn.textContent = isSubscribed ? '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
        }

        async function toggleSubscription() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) {
                alert('–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è');
                return;
            }

            if (isSubscribed) {
                await fetch('/api/unsubscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: user.id,
                        channelId: currentChannelId
                    })
                });
            } else {
                await fetch('/api/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: user.id,
                        channelId: currentChannelId
                    })
                });
            }

            location.reload();
        }
    </script>
</body>
</html>
